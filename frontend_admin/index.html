<!DOCTYPE html>
<!--
    âš ï¸ ì¤‘ìš”: ì´ íŒŒì¼ì„ ì§ì ‘ ì—´ë©´ CORS ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤!
    
    ì‹¤í–‰ ë°©ë²•:
    1. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ (í¬íŠ¸ 8000):
       - backend í´ë”ì—ì„œ: uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
       - ë˜ëŠ”: docker-compose up
       
    2. í”„ë¡ íŠ¸ì—”ë“œ ë¡œì»¬ ì„œë²„ ì‹¤í–‰:
       - Windows: start-server.bat ì‹¤í–‰
       - Mac/Linux: ./start-server.sh ì‹¤í–‰
       - ë˜ëŠ”: python -m http.server 8001
       
    3. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8001 ì ‘ì†
    
    API ì„¤ì •:
    - ë°±ì—”ë“œ: http://localhost:8000
    - API ì—”ë“œí¬ì¸íŠ¸: http://localhost:8000/api/v1
    
    ìì„¸í•œ ë‚´ìš©ì€ README_SERVER.md ì°¸ê³ 
-->
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        :root {
            /* ë°°ê²½ìƒ‰ */
            --bg: #f7f8fb;
            --card: #ffffff;
            
            /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            --text: #0f172a;
            --muted: #64748b;
            
            /* ê²½ê³„ì„  */
            --line: #e5e7eb;
            
            /* Primary ìƒ‰ìƒ */
            --primary: #2563eb;
            --primary2: #1d4ed8;
            
            /* Border Radius */
            --radius: 18px;
            
            /* ê·¸ë¦¼ì */
            --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
            
            /* Chip/Badge ë°°ê²½ */
            --chip: #eef2ff;
            
            /* Success/Danger ìƒ‰ìƒ */
            --success: #10b981;
            --success-bg: #d1fae5;
            --danger: #ef4444;
            --danger-bg: #fee2e2;
            --warning: #f59e0b;
            --warning-bg: #fef3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 28px 18px;
        }

        header {
            background: var(--card);
            padding: 24px 28px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--line);
        }

        h1 {
            color: var(--text);
            margin: 0 0 12px;
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.5px;
        }

        h2 {
            color: var(--text);
            margin: 0 0 10px;
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -0.3px;
        }

        h3 {
            color: var(--text);
            margin: 0 0 8px;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.2px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            padding: 12px 16px;
            border: 1px solid var(--line);
            border-radius: 14px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: transform 0.06s ease, background 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
            background: var(--card);
            color: var(--text);
        }

        button:hover {
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 10px 22px rgba(37, 99, 235, 0.18);
        }

        .btn-primary:hover {
            background: var(--primary2);
            border-color: var(--primary2);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-success:hover {
            background: #059669;
            border-color: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-danger:hover {
            background: #dc2626;
            border-color: #dc2626;
        }

        .btn-secondary {
            background: var(--card);
            color: var(--muted);
            border-color: var(--line);
        }

        .btn-secondary:hover {
            background: #f8f9fa;
            color: var(--text);
        }

        .products-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .products-list {
            background: var(--card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--line);
            max-height: 85vh;
            overflow-y: auto;
        }

        .products-list h2 {
            margin-bottom: 20px;
        }

        .product-detail {
            background: var(--card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--line);
            max-height: 85vh;
            overflow-y: auto;
        }

        .product-item {
            padding: 16px;
            border: 1px solid var(--line);
            border-radius: 14px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--card);
        }

        .product-item:hover {
            background: #f8f9fa;
            border-color: var(--primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
        }

        .product-item.active {
            background: linear-gradient(180deg, rgba(37, 99, 235, 0.06), rgba(255, 255, 255, 0.92));
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        .product-item.inactive {
            opacity: 0.6;
        }

        .product-item h3 {
            margin-bottom: 8px;
            color: var(--text);
            font-size: 16px;
            font-weight: 700;
        }

        .product-item .meta {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.5;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            margin-right: 6px;
            margin-top: 6px;
        }

        .status-active {
            background: var(--success-bg);
            color: #065f46;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-inactive {
            background: var(--danger-bg);
            color: #991b1b;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--line);
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            background: var(--card);
            color: var(--text);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--line);
            margin-bottom: 24px;
            gap: 4px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--muted);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s ease;
            border-radius: 8px 8px 0 0;
        }

        .tab:hover {
            color: var(--text);
            background: #f8f9fa;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(37, 99, 235, 0.04);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--line);
        }

        .table th,
        .table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--line);
        }

        .table th {
            background: #f8f9fa;
            font-weight: 700;
            color: var(--text);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }

        .empty-state p {
            font-size: 16px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.55);
            z-index: 1000;
            overflow-y: auto;
            align-items: center;
            justify-content: center;
            padding: 18px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            border-radius: var(--radius);
            padding: 28px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 18px 60px rgba(15, 23, 42, 0.25);
            border: 1px solid var(--line);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            color: var(--text);
            font-size: 24px;
            font-weight: 900;
            letter-spacing: -0.3px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--muted);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            color: var(--text);
            background: #f8f9fa;
        }

        .alert {
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            border: 1px solid;
        }

        .alert-success {
            background: var(--success-bg);
            color: #065f46;
            border-color: rgba(16, 185, 129, 0.3);
        }

        .alert-error {
            background: var(--danger-bg);
            color: #991b1b;
            border-color: rgba(239, 68, 68, 0.3);
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
            font-size: 16px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .number-input {
            width: 120px;
        }

        /* ======================================
           ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡ - ê²€ìƒ‰/í•„í„° íŒ¨ë„
           ====================================== */
        .product-list-container {
            width: 100%;
            max-width: 100%;
            overflow: visible;
        }

        /* í•„í„° ì „ì²´ ë°•ìŠ¤ */
        .filter-panel {
            padding: 16px;
            border: 1px solid var(--line);
            border-radius: 14px;
            background: var(--card);
            margin-bottom: 20px;
        }

        /* í•„í„° í•œ ì¤„ */
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        /* ê³µí†µ ì¸í’‹/ì…€ë ‰íŠ¸ */
        .filter-control {
            height: 40px;
            padding: 0 12px;
            border: 1px solid var(--line);
            border-radius: 10px;
            font-size: 14px;
            background: var(--card);
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            font-family: inherit;
            color: var(--text);
        }

        .filter-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* ê²€ìƒ‰ì°½ */
        .filter-search {
            flex: 1 1 240px;
            min-width: 220px;
        }

        /* ì…€ë ‰íŠ¸ë“¤ */
        .filter-select {
            flex: 0 1 120px;
            min-width: 100px;
        }

        /* ì •ë ¬ ë“œë¡­ë‹¤ìš´ (í•œ ì¤„ ì „ì²´ ì‚¬ìš©) */
        .filter-sort {
            width: 100%;
            margin-top: 6px;
        }

        /* ì—ëŸ¬ ë°•ìŠ¤ */
        #errorBox {
            display: none;
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 10px;
            background: var(--danger-bg);
            color: #991b1b;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* ì½”ë“œ ìŠ¤íƒ€ì¼ */
        code {
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            color: #475569;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .products-list,
            .product-detail {
                max-height: 50vh;
            }
        }

        @media (max-width: 900px) {
            .filter-row {
                gap: 8px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 18px 14px;
            }

            h1 {
                font-size: 26px;
            }

            h2 {
                font-size: 20px;
            }

            header {
                padding: 18px;
            }

            .products-list,
            .product-detail {
                padding: 18px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .tabs::-webkit-scrollbar {
                display: none;
            }

            .tab {
                white-space: nowrap;
                padding: 10px 16px;
                font-size: 13px;
            }

            .modal-content {
                padding: 20px;
                margin: 10px;
                max-width: calc(100% - 20px);
            }

            .filter-search {
                flex: 1 1 100%;
            }
            
            .filter-select {
                flex: 1 1 48%;
                min-width: 140px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .controls label {
                margin-left: 0 !important;
            }

            .product-item h3 {
                font-size: 15px;
            }

            .product-item .meta {
                font-size: 11px;
            }

            .table {
                font-size: 13px;
            }

            .table th,
            .table td {
                padding: 10px 12px;
            }
        }

        @media (max-width: 520px) {
            h1 {
                font-size: 22px;
            }

            button {
                padding: 10px 14px;
                font-size: 13px;
            }

            .status-badge {
                font-size: 11px;
                padding: 5px 10px;
            }

            .filter-search {
                flex: 1 1 100%;
            }
            
            .filter-select {
                flex: 1 1 48%;
                min-width: 140px;
            }

            .filter-panel {
                padding: 12px;
            }

            .filter-control {
                height: 38px;
                font-size: 13px;
            }
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .products-list::-webkit-scrollbar,
        .product-detail::-webkit-scrollbar,
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .products-list::-webkit-scrollbar-track,
        .product-detail::-webkit-scrollbar-track,
        .modal-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        .products-list::-webkit-scrollbar-thumb,
        .product-detail::-webkit-scrollbar-thumb,
        .modal-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .products-list::-webkit-scrollbar-thumb:hover,
        .product-detail::-webkit-scrollbar-thumb:hover,
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¾ ìƒí’ˆ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
            <div class="controls">
                <button class="btn-primary" onclick="handlers.showCreateProductModal()">+ ìƒˆ ìƒí’ˆ ë“±ë¡</button>
                <button class="btn-secondary" onclick="handlers.loadProducts()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                <label style="display: flex; align-items: center; gap: 10px; margin-left: auto; cursor: pointer; font-size: 14px; color: var(--text);">
                    <input type="checkbox" id="includeInactive" onchange="handlers.loadProducts()" 
                           style="width: auto; cursor: pointer;">
                    <span>ë¹„í™œì„± ìƒí’ˆ í¬í•¨</span>
                </label>
            </div>
        </header>

        <div id="alertContainer"></div>

        <div class="products-grid">
            <div class="products-list">
                <h2>ìƒí’ˆ ëª©ë¡</h2>
                
                <!-- í•„í„° íŒ¨ë„ -->
                <div class="product-list-container">
                    <div class="filter-panel">
                        <div class="filter-row">
                            <input
                                class="filter-control filter-search"
                                type="text"
                                placeholder="ğŸ” ê²€ìƒ‰ (ë¸Œëœë“œ / ìƒí’ˆëª… / ìš©ëŸ‰)"
                                id="filterQuery"
                                onkeyup="handlers.applyFilters()"
                            />

                            <select class="filter-control filter-select" id="filterSpecies" onchange="handlers.applyFilters()">
                            <option value="ALL">ì „ì²´ ì¢…ë¥˜</option>
                            <option value="DOG">ê°•ì•„ì§€</option>
                            <option value="CAT">ê³ ì–‘ì´</option>
                        </select>

                            <select class="filter-control filter-select" id="filterActive" onchange="handlers.applyFilters()">
                            <option value="ACTIVE">í™œì„±</option>
                            <option value="ARCHIVED">ë¹„í™œì„±</option>
                            <option value="ALL">ì „ì²´</option>
                        </select>

                            <select class="filter-control filter-select" id="filterCompletion" onchange="handlers.applyFilters()">
                                <option value="ALL">ì™„ì„±ë„ ì „ì²´</option>
                            <option value="COMPLETE">ì™„ì„±</option>
                                <option value="MISSING_INGREDIENTS">ì„±ë¶„ ë¯¸ì™„</option>
                                <option value="MISSING_NUTRITION">ì˜ì–‘ ë¯¸ì™„</option>
                                <option value="MISSING_OFFERS">íŒë§¤ì²˜ ë¯¸ì™„</option>
                        </select>

                            <select class="filter-control filter-select" id="filterHasImage" onchange="handlers.applyFilters()">
                            <option value="ALL">ì´ë¯¸ì§€ ì „ì²´</option>
                                <option value="YES">ì´ë¯¸ì§€ ìˆìŒ</option>
                                <option value="NO">ì´ë¯¸ì§€ ì—†ìŒ</option>
                        </select>

                            <select class="filter-control filter-select" id="filterHasOffers" onchange="handlers.applyFilters()">
                                <option value="ALL">íŒë§¤ì²˜ ì „ì²´</option>
                                <option value="YES">íŒë§¤ì²˜ ìˆìŒ</option>
                                <option value="NO">íŒë§¤ì²˜ ì—†ìŒ</option>
                        </select>

                            <select class="filter-control filter-sort" id="filterSort" onchange="handlers.applyFilters()">
                            <option value="UPDATED_DESC">ìµœê·¼ ìˆ˜ì •ìˆœ</option>
                                <option value="BRAND_ASC">ë¸Œëœë“œìˆœ</option>
                            <option value="INCOMPLETE_FIRST">ë¯¸ì™„ì„± ìš°ì„ </option>
                        </select>
                    </div>
                        
                        <div style="display: flex; gap: 12px; align-items: center; margin-top: 12px; flex-wrap: wrap;">
                            <span id="paginationInfo" style="font-size: 13px; color: var(--muted); font-weight: 500;">ì´ 0ê°œ (í˜ì´ì§€ 1)</span>
                        </div>
                    </div>
                    
                    <!-- ì—ëŸ¬ ë°•ìŠ¤ -->
                    <div id="errorBox"></div>
                </div>
                
                <div id="productsList" class="loading">ë¡œë”© ì¤‘...</div>
            </div>

            <div class="product-detail">
                <div id="productDetail">
                    <div class="empty-state">
                        <p style="font-size: 16px; color: var(--muted);">ìƒí’ˆì„ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <p style="font-size: 14px; color: var(--muted); margin-top: 8px;">ì¢Œì¸¡ ëª©ë¡ì—ì„œ ìƒí’ˆì„ í´ë¦­í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒí’ˆ ìƒì„±/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ìƒí’ˆ ë“±ë¡</h2>
                <button class="close-btn" onclick="closeProductModal()">&times;</button>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">
                
                <div class="form-group">
                    <label>ë¸Œëœë“œëª… *</label>
                    <input type="text" id="brandName" required>
                </div>

                <div class="form-group">
                    <label>ìƒí’ˆëª… *</label>
                    <input type="text" id="productName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ìš©ëŸ‰ (ì˜ˆ: 3kg)</label>
                        <input type="text" id="sizeLabel">
                    </div>

                    <div class="form-group">
                        <label>ì¹´í…Œê³ ë¦¬</label>
                        <select id="category">
                            <option value="FOOD">FOOD</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ë°˜ë ¤ë™ë¬¼ ì¢…ë¥˜</label>
                        <select id="species">
                            <option value="">ì„ íƒ ì•ˆí•¨</option>
                            <option value="DOG">ê°•ì•„ì§€</option>
                            <option value="CAT">ê³ ì–‘ì´</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>í™œì„± ìƒíƒœ</label>
                        <select id="isActive">
                            <option value="true">í™œì„±</option>
                            <option value="false">ë¹„í™œì„±</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>ê´€ë¦¬ì ë©”ëª¨</label>
                    <textarea id="adminMemo" rows="3" placeholder="ê´€ë¦¬ìš© ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 24px; justify-content: flex-end;">
                    <button type="button" class="btn-secondary" onclick="closeProductModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn-success">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==============================================
        // ì „ì—­ ìƒíƒœ ê°ì²´
        // ==============================================
        const state = {
            products: [],
            selectedProductId: null,
            filters: {
                query: '',
                species: 'ALL',
                active: 'ACTIVE',
                completion: 'ALL',
                hasImage: 'ALL',
                hasOffers: 'ALL'
            },
            sort: 'UPDATED_DESC',
            pagination: {
                page: 1,
                size: 30,
                total: 0
            },
            codes: {
                allergenCodes: [],
                claimCodes: []
            },
            ui: {
                tab: 'BASIC',
                dirty: false
            }
        };

        const API_BASE = 'http://localhost:8000/api/v1';

        // ==============================================
        // API í˜¸ì¶œ í•¨ìˆ˜ë“¤ (api.*)
        // ==============================================
        const api = {
            // ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸
            async testConnection() {
                try {
                    const response = await fetch('http://localhost:8000/health', {
                        method: 'GET',
                        signal: AbortSignal.timeout(3000) // 3ì´ˆ íƒ€ì„ì•„ì›ƒ
                    });
                    return response.ok;
                } catch (error) {
                    console.error('[API] Health check ì‹¤íŒ¨:', error);
                    return false;
                }
            },

            async getProducts() {
                const params = new URLSearchParams({
                    query: state.filters.query || '',
                    species: state.filters.species !== 'ALL' ? state.filters.species : '',
                    active: state.filters.active,
                    completion_status: state.filters.completion !== 'ALL' ? state.filters.completion : '',
                    has_image: state.filters.hasImage !== 'ALL' ? state.filters.hasImage : '',
                    has_offers: state.filters.hasOffers !== 'ALL' ? state.filters.hasOffers : '',
                    sort: state.sort,
                    page: state.pagination.page,
                    size: state.pagination.size
                });
                
                const url = `${API_BASE}/admin/products?${params}`;
                console.log('[API] ìš”ì²­ URL:', url);
                console.log('[API] ìš”ì²­ íŒŒë¼ë¯¸í„°:', Object.fromEntries(params));
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => {
                    console.error('[API] íƒ€ì„ì•„ì›ƒ ë°œìƒ - ë°±ì—”ë“œê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                    controller.abort();
                }, 15000); // 15ì´ˆ íƒ€ì„ì•„ì›ƒ (ë°±ì—”ë“œ ì‘ë‹µì´ ëŠë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
                
                try {
                    const response = await fetch(url, {
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    
                    console.log('[API] ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                    console.log('[API] ì‘ë‹µ í—¤ë”:', Object.fromEntries(response.headers.entries()));
                    
                if (!response.ok) {
                        let errorMessage = 'ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        try {
                    const error = await response.json();
                            console.error('[API] ì—ëŸ¬ ì‘ë‹µ:', error);
                            errorMessage = error.detail || errorMessage;
                        } catch (e) {
                            console.error('[API] JSON íŒŒì‹± ì‹¤íŒ¨:', e);
                            const text = await response.text();
                            console.error('[API] ì‘ë‹µ ë³¸ë¬¸:', text);
                            errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                        }
                        throw new Error(errorMessage);
                    }
                    
                    const data = await response.json();
                    console.log('[API] ì„±ê³µ ì‘ë‹µ:', data);
                    return data;
                } catch (error) {
                    clearTimeout(timeoutId);
                    console.error('[API] ìš”ì²­ ì‹¤íŒ¨:', error);
                    if (error.name === 'AbortError') {
                        throw new Error('ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                    }
                    if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                        throw new Error('ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”. (http://localhost:8000)');
                    }
                    throw error;
                }
            },

            async getProduct(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}`);
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async createProduct(data) {
                const response = await fetch(`${API_BASE}/admin/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ìƒí’ˆ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async updateProduct(productId, data) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ìƒí’ˆ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async archiveProduct(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/archive`, {
                    method: 'POST'
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ìƒí’ˆ ë¹„í™œì„±í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async unarchiveProduct(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/unarchive`, {
                    method: 'POST'
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ìƒí’ˆ ë³µêµ¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async updateProductImages(productId, data) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/images`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async getProductOffers(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/offers`);
                if (!response.ok) throw new Error('íŒë§¤ì²˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return await response.json();
            },

            async createOffer(productId, data) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/offers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'íŒë§¤ì²˜ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async updateOffer(offerId, data) {
                const response = await fetch(`${API_BASE}/admin/offers/${offerId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'íŒë§¤ì²˜ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async deleteOffer(offerId) {
                const response = await fetch(`${API_BASE}/admin/offers/${offerId}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('íŒë§¤ì²˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            },

            async getIngredientProfile(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/ingredient`);
                if (response.status === 404) return null;
                if (!response.ok) throw new Error('ì„±ë¶„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return await response.json();
            },

            async updateIngredientProfile(productId, data) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/ingredient`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ì„±ë¶„ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async analyzeAndSaveIngredients(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/ingredient/analyze-and-save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'AI ë¶„ì„ ë° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async getNutritionFacts(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/nutrition`);
                if (response.status === 404) return null;
                if (!response.ok) throw new Error('ì˜ì–‘ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return await response.json();
            },

            async updateNutritionFacts(productId, data) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/nutrition`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ì˜ì–‘ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async getAllergenCodes() {
                const response = await fetch(`${API_BASE}/admin/allergen-codes`);
                if (!response.ok) throw new Error('ì•Œë ˆë¥´ê² ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return await response.json();
            },

            async getProductAllergens(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/allergens`);
                if (!response.ok) throw new Error('ì•Œë ˆë¥´ê² ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return await response.json();
            },

            async addProductAllergen(productId, data) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/allergens`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ì•Œë ˆë¥´ê² ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async deleteProductAllergen(productId, allergenCode) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/allergens/${allergenCode}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('ì•Œë ˆë¥´ê² ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            },

            async getClaimCodes() {
                const response = await fetch(`${API_BASE}/admin/claim-codes`);
                if (!response.ok) throw new Error('í´ë ˆì„ ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return await response.json();
            },

            async getProductClaims(productId) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/claims`);
                if (!response.ok) throw new Error('í´ë ˆì„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return await response.json();
            },

            async addProductClaim(productId, data) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/claims`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'í´ë ˆì„ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return await response.json();
            },

            async deleteProductClaim(productId, claimCode) {
                const response = await fetch(`${API_BASE}/admin/products/${productId}/claims/${claimCode}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('í´ë ˆì„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        };

        // ==============================================
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ (utils.*)
        // ==============================================
        const utils = {
            showAlert(message, type = 'success') {
                const container = document.getElementById('alertContainer');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                container.appendChild(alert);
                setTimeout(() => alert.remove(), 3000);
            },

            formatDate(dateString) {
                if (!dateString) return '-';
                const date = new Date(dateString);
                return date.toLocaleString('ko-KR', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },

            confirmAction(message) {
                return confirm(message);
            },

            checkDirty() {
                if (state.ui.dirty) {
                    return utils.confirmAction('ì €ì¥í•˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                }
                return true;
            },

            setDirty(value) {
                state.ui.dirty = value;
            },

            showError(message) {
                const errorBox = document.getElementById('errorBox');
                if (!errorBox) return;
                errorBox.innerText = message;
                errorBox.style.display = 'block';
                // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
                setTimeout(() => {
                    errorBox.style.display = 'none';
                }, 5000);
            },

            hideError() {
                const errorBox = document.getElementById('errorBox');
                if (errorBox) {
                    errorBox.style.display = 'none';
                }
            }
        };

        // ==============================================
        // ë Œë”ë§ í•¨ìˆ˜ë“¤ (render.*)
        // ==============================================
        const render = {
            productList(products) {
                const container = document.getElementById('productsList');
                if (products.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p style="font-size: 16px; color: var(--muted);">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p><p style="font-size: 14px; color: var(--muted); margin-top: 8px;">ìƒˆ ìƒí’ˆì„ ë“±ë¡í•´ë³´ì„¸ìš”.</p></div>';
                    return;
                }

                container.innerHTML = products.map(product => {
                    const badges = [];
                    if (!product.has_image) badges.push('<span class="status-badge" style="background: var(--warning-bg); color: #92400e; border: 1px solid rgba(245, 158, 11, 0.2);">ì´ë¯¸ì§€X</span>');
                    if (product.offers_count === 0) badges.push('<span class="status-badge" style="background: var(--danger-bg); color: #991b1b; border: 1px solid rgba(239, 68, 68, 0.2);">ì˜¤í¼0</span>');
                    if (!product.ingredient_exists) badges.push('<span class="status-badge" style="background: #dbeafe; color: #1e40af; border: 1px solid rgba(37, 99, 235, 0.2);">ì„±ë¶„X</span>');
                    if (!product.nutrition_exists) badges.push('<span class="status-badge" style="background: #dbeafe; color: #1e40af; border: 1px solid rgba(37, 99, 235, 0.2);">ì˜ì–‘X</span>');
                    
                    const completionBadge = product.completion_status 
                        ? `<span class="status-badge" style="background: ${product.completion_status === 'COMPLETE' ? 'var(--success-bg)' : 'var(--warning-bg)'}; color: ${product.completion_status === 'COMPLETE' ? '#065f46' : '#92400e'}; border: 1px solid ${product.completion_status === 'COMPLETE' ? 'rgba(16, 185, 129, 0.2)' : 'rgba(245, 158, 11, 0.2)'};">${product.completion_status}</span>`
                        : '';

                    return `
                        <div class="product-item ${!product.is_active ? 'inactive' : ''} ${state.selectedProductId === product.id ? 'active' : ''}" 
                             onclick="handlers.selectProduct('${product.id}')">
                            ${product.thumbnail_url ? `<img src="${product.thumbnail_url}" style="width: 64px; height: 64px; object-fit: cover; border-radius: 10px; float: left; margin-right: 12px; border: 1px solid var(--line);" onerror="this.style.display='none'">` : ''}
                            <h3>${product.brand_name} ${product.product_name}</h3>
                            <div class="meta">
                                <code>${product.id}</code>
                                ${product.size_label ? ` Â· ìš©ëŸ‰: ${product.size_label} Â· ` : ' Â· '}
                                ${product.species || 'ê³µìš©'} Â· 
                                ${product.category}
                                ${product.last_admin_updated_at ? ` Â· ìˆ˜ì •: ${utils.formatDate(product.last_admin_updated_at)}` : ''}
                            </div>
                            <div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px;">
                                ${badges.join('')}
                                ${completionBadge}
                                <span class="status-badge ${product.is_active ? 'status-active' : 'status-inactive'}">
                                    ${product.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            productDetail(product) {
                const container = document.getElementById('productDetail');
                container.innerHTML = `
                    <div class="tabs">
                        <button class="tab ${state.ui.tab === 'BASIC' ? 'active' : ''}" onclick="handlers.switchTab('BASIC', this)">ê¸°ë³¸ ì •ë³´</button>
                        <button class="tab ${state.ui.tab === 'IMAGES' ? 'active' : ''}" onclick="handlers.switchTab('IMAGES', this)">ì´ë¯¸ì§€</button>
                        <button class="tab ${state.ui.tab === 'OFFERS' ? 'active' : ''}" onclick="handlers.switchTab('OFFERS', this)">íŒë§¤ì²˜</button>
                        <button class="tab ${state.ui.tab === 'INGREDIENTS' ? 'active' : ''}" onclick="handlers.switchTab('INGREDIENTS', this)">ì„±ë¶„</button>
                        <button class="tab ${state.ui.tab === 'NUTRITION' ? 'active' : ''}" onclick="handlers.switchTab('NUTRITION', this)">ì˜ì–‘</button>
                        <button class="tab ${state.ui.tab === 'ALLERGENS' ? 'active' : ''}" onclick="handlers.switchTab('ALLERGENS', this)">ì•Œë ˆë¥´ê²</button>
                        <button class="tab ${state.ui.tab === 'CLAIMS' ? 'active' : ''}" onclick="handlers.switchTab('CLAIMS', this)">í´ë ˆì„</button>
                    </div>

                    <div class="tab-content ${state.ui.tab === 'BASIC' ? 'active' : ''}" id="tab-BASIC">
                        ${render.tabBasic(product)}
                    </div>

                    <div class="tab-content ${state.ui.tab === 'IMAGES' ? 'active' : ''}" id="tab-IMAGES">
                        ${render.tabImages(product)}
                    </div>

                    <div class="tab-content ${state.ui.tab === 'OFFERS' ? 'active' : ''}" id="tab-OFFERS">
                        ${render.tabOffers(product)}
                    </div>

                    <div class="tab-content ${state.ui.tab === 'INGREDIENTS' ? 'active' : ''}" id="tab-INGREDIENTS">
                        ${render.tabIngredients(product)}
                    </div>

                    <div class="tab-content ${state.ui.tab === 'NUTRITION' ? 'active' : ''}" id="tab-NUTRITION">
                        ${render.tabNutrition(product)}
                    </div>

                    <div class="tab-content ${state.ui.tab === 'ALLERGENS' ? 'active' : ''}" id="tab-ALLERGENS">
                        ${render.tabAllergens(product)}
                    </div>

                    <div class="tab-content ${state.ui.tab === 'CLAIMS' ? 'active' : ''}" id="tab-CLAIMS">
                        ${render.tabClaims(product)}
                    </div>
                `;

                // ê° íƒ­ ë°ì´í„° ë¡œë“œ
                if (state.ui.tab === 'INGREDIENTS') handlers.loadIngredientData(product.id);
                if (state.ui.tab === 'NUTRITION') handlers.loadNutritionData(product.id);
                if (state.ui.tab === 'OFFERS') handlers.loadOffersData(product.id);
                if (state.ui.tab === 'ALLERGENS') handlers.loadAllergenData(product.id);
                if (state.ui.tab === 'CLAIMS') handlers.loadClaimData(product.id);
            },

            tabBasic(product) {
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>${product.brand_name} ${product.product_name}</h2>
                        <div>
                            <button class="btn-primary" onclick="handlers.editProduct('${product.id}')">ìˆ˜ì •</button>
                            <button class="btn-${product.is_active ? 'danger' : 'success'}" onclick="handlers.toggleArchive('${product.id}', ${!product.is_active})" style="margin-left: 10px;">
                                ${product.is_active ? 'ë¹„í™œì„±í™”' : 'ë³µêµ¬'}
                            </button>
                        </div>
                    </div>
                    <table class="table">
                        <tr><th>ìƒí’ˆ ID</th><td><code>${product.id}</code></td></tr>
                        <tr><th>ë¸Œëœë“œëª…</th><td>${product.brand_name}</td></tr>
                        <tr><th>ìƒí’ˆëª…</th><td>${product.product_name}</td></tr>
                        <tr><th>ìš©ëŸ‰</th><td>${product.size_label || '-'}</td></tr>
                        <tr><th>ì¹´í…Œê³ ë¦¬</th><td>${product.category || 'FOOD'}</td></tr>
                        <tr><th>ë°˜ë ¤ë™ë¬¼ ì¢…ë¥˜</th><td>${product.species || 'ê³µìš©'}</td></tr>
                        <tr><th>ì™„ì„±ë„ ìƒíƒœ</th><td>${product.completion_status ? `<span class="status-badge" style="background: ${product.completion_status === 'COMPLETE' ? 'var(--success-bg)' : 'var(--warning-bg)'}; color: ${product.completion_status === 'COMPLETE' ? '#065f46' : '#92400e'}; border: 1px solid ${product.completion_status === 'COMPLETE' ? 'rgba(16, 185, 129, 0.2)' : 'rgba(245, 158, 11, 0.2)'};">${product.completion_status}</span>` : '-'}</td></tr>
                        <tr><th>ê´€ë¦¬ì ë©”ëª¨</th><td>${product.admin_memo || '-'}</td></tr>
                        <tr><th>ìƒíƒœ</th><td><span class="status-badge ${product.is_active ? 'status-active' : 'status-inactive'}">${product.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}</span></td></tr>
                    </table>
                `;
            },

            tabImages(product) {
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ì´ë¯¸ì§€ ê´€ë¦¬</h3>
                        <button class="btn-primary" onclick="handlers.editImages('${product.id}')">ìˆ˜ì •</button>
                    </div>
                    <div id="imagesContent">
                        <table class="table">
                            <tr><th>ëŒ€í‘œ ì´ë¯¸ì§€</th><td>${product.primary_image_url ? `<img src="${product.primary_image_url}" style="max-width: 200px; border-radius: 10px; border: 1px solid var(--line);" onerror="this.style.display='none'">` : '-'}</td></tr>
                            <tr><th>ì¸ë„¤ì¼</th><td>${product.thumbnail_url ? `<img src="${product.thumbnail_url}" style="max-width: 200px; border-radius: 10px; border: 1px solid var(--line);" onerror="this.style.display='none'">` : '-'}</td></tr>
                            <tr><th>ì¶”ê°€ ì´ë¯¸ì§€</th><td>${product.images && product.images.length > 0 ? product.images.map(url => `<img src="${url}" style="max-width: 100px; margin: 5px; border-radius: 8px; border: 1px solid var(--line);" onerror="this.style.display='none'">`).join('') : '-'}</td></tr>
                        </table>
                    </div>
                `;
            },

            tabOffers(product) {
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>íŒë§¤ì²˜ ê´€ë¦¬</h3>
                        <button class="btn-primary" onclick="handlers.addOffer('${product.id}')">+ íŒë§¤ì²˜ ì¶”ê°€</button>
                    </div>
                    <div id="offersContent" class="loading">ë¡œë”© ì¤‘...</div>
                `;
            },

            tabIngredients(product) {
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ì„±ë¶„ ì •ë³´</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-secondary" onclick="handlers.analyzeAndSaveIngredients('${product.id}')" style="background: #6366f1; color: white;">ğŸ¤– AI ë¶„ì„</button>
                            <button class="btn-primary" onclick="handlers.editIngredient('${product.id}')">ìˆ˜ì •</button>
                        </div>
                    </div>
                    <div id="ingredientContent" class="loading">ë¡œë”© ì¤‘...</div>
                `;
            },

            tabNutrition(product) {
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ì˜ì–‘ ì •ë³´</h3>
                        <button class="btn-primary" onclick="handlers.editNutrition('${product.id}')">ìˆ˜ì •</button>
                    </div>
                    <div id="nutritionContent" class="loading">ë¡œë”© ì¤‘...</div>
                `;
            },

            tabAllergens(product) {
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ì•Œë ˆë¥´ê²</h3>
                        <button class="btn-primary" onclick="handlers.addAllergenInline('${product.id}')">+ ì¶”ê°€</button>
                    </div>
                    <div id="allergenContent" class="loading">ë¡œë”© ì¤‘...</div>
                `;
            },

            tabClaims(product) {
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ê¸°ëŠ¥ì„± í´ë ˆì„</h3>
                        <button class="btn-primary" onclick="handlers.addClaimInline('${product.id}')">+ ì¶”ê°€</button>
                    </div>
                    <div id="claimContent" class="loading">ë¡œë”© ì¤‘...</div>
                `;
            }
        };

        // ==============================================
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤ (handlers.*)
        // ==============================================
        const handlers = {
            async init() {
                // ìƒí’ˆ ëª©ë¡ ë°”ë¡œ ë¡œë“œ (health checkëŠ” ì„ íƒì )
                await this.loadProducts();
                
                // ì½”ë“œ ëª©ë¡ ë¯¸ë¦¬ ë¡œë“œ
                try {
                    state.codes.allergenCodes = await api.getAllergenCodes();
                    state.codes.claimCodes = await api.getClaimCodes();
                } catch (error) {
                    console.error('ì½”ë“œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            },

            async loadProducts() {
                const container = document.getElementById('productsList');
                try {
                    utils.hideError();
                    container.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';
                    
                    // ë°±ì—”ë“œ ì—°ê²° í™•ì¸
                    console.log('ë°±ì—”ë“œ ì—°ê²° í™•ì¸ ì¤‘...');
                    const isConnected = await api.testConnection();
                    if (!isConnected) {
                        throw new Error('ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.\n\në°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ ë°©ë²•:\n1. í„°ë¯¸ë„ì—ì„œ cd backend\n2. uvicorn app.main:app --reload --host 0.0.0.0 --port 8000');
                    }
                    console.log('ë°±ì—”ë“œ ì—°ê²° í™•ì¸ ì™„ë£Œ');
                    
                    console.log('ìƒí’ˆ ëª©ë¡ ë¡œë“œ ì‹œì‘...');
                    const response = await api.getProducts();
                    console.log('API Response:', response); // ë””ë²„ê¹…ìš©
                    
                    // ì‘ë‹µ í˜•ì‹ í™•ì¸ ë° ì²˜ë¦¬
                    if (!response) {
                        throw new Error('ì„œë²„ì—ì„œ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                    }
                    
                    state.products = response.items || [];
                    state.pagination.total = response.total || response.total_count || 0;
                    state.pagination.page = response.page || 1;
                    
                    console.log(`ë¡œë“œëœ ìƒí’ˆ ìˆ˜: ${state.products.length}, ì´: ${state.pagination.total}`);
                    
                    // í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
                    const paginationInfo = document.getElementById('paginationInfo');
                    if (paginationInfo) {
                        paginationInfo.textContent = `ì´ ${state.pagination.total}ê°œ (í˜ì´ì§€ ${state.pagination.page})`;
                    }
                    
                    render.productList(state.products);
                } catch (error) {
                    console.error('Load products error:', error);
                    const errorMessage = error.message || 'ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                    container.innerHTML = `
                        <div class="empty-state">
                            <p style="font-size: 16px; color: var(--muted); margin-bottom: 10px;">ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="font-size: 14px; color: var(--muted);">${errorMessage}</p>
                            <button class="btn-primary" onclick="handlers.loadProducts()" style="margin-top: 16px;">ë‹¤ì‹œ ì‹œë„</button>
                        </div>
                    `;
                    utils.showError(errorMessage);
                    utils.showAlert(errorMessage, 'error');
                }
            },

            applyFilters() {
                state.filters.query = document.getElementById('filterQuery').value;
                state.filters.species = document.getElementById('filterSpecies').value;
                state.filters.active = document.getElementById('filterActive').value;
                state.filters.completion = document.getElementById('filterCompletion').value;
                state.filters.hasImage = document.getElementById('filterHasImage').value;
                state.filters.hasOffers = document.getElementById('filterHasOffers').value;
                state.sort = document.getElementById('filterSort').value;
                state.pagination.page = 1; // í•„í„° ë³€ê²½ ì‹œ ì²« í˜ì´ì§€ë¡œ
                this.loadProducts();
            },

            async selectProduct(productId) {
                if (!utils.checkDirty()) return;
                
                state.selectedProductId = productId;
                utils.setDirty(false);
                await this.loadProducts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ active ìƒíƒœ ì—…ë°ì´íŠ¸
                
                const container = document.getElementById('productDetail');
                container.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';

                try {
                    const product = await api.getProduct(productId);
                    render.productDetail(product);
                } catch (error) {
                    container.innerHTML = `<div class="alert alert-error">${error.message}</div>`;
                    utils.showAlert(error.message, 'error');
                }
            },

            switchTab(tabName, eventElement) {
                if (!utils.checkDirty()) return;
                
                state.ui.tab = tabName;
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // ì´ë²¤íŠ¸ ìš”ì†Œê°€ ì „ë‹¬ëœ ê²½ìš°ì—ë§Œ active í´ë˜ìŠ¤ ì¶”ê°€
                if (eventElement) {
                    eventElement.classList.add('active');
                } else {
                    // ì´ë²¤íŠ¸ ìš”ì†Œê°€ ì—†ìœ¼ë©´ íƒ­ ì´ë¦„ìœ¼ë¡œ ì°¾ê¸°
                    const tabButton = Array.from(document.querySelectorAll('.tab')).find(btn => 
                        btn.textContent.includes(tabName === 'BASIC' ? 'ê¸°ë³¸' : 
                                                tabName === 'IMAGES' ? 'ì´ë¯¸ì§€' :
                                                tabName === 'OFFERS' ? 'íŒë§¤ì²˜' :
                                                tabName === 'INGREDIENTS' ? 'ì„±ë¶„' :
                                                tabName === 'NUTRITION' ? 'ì˜ì–‘' :
                                                tabName === 'ALLERGENS' ? 'ì•Œë ˆë¥´ê²' :
                                                tabName === 'CLAIMS' ? 'í´ë ˆì„' : '')
                    );
                    if (tabButton) tabButton.classList.add('active');
                }
                
                const tabContent = document.getElementById(`tab-${tabName}`);
                if (tabContent) tabContent.classList.add('active');
                
                // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
                if (state.selectedProductId) {
                    if (tabName === 'INGREDIENTS') this.loadIngredientData(state.selectedProductId);
                    if (tabName === 'NUTRITION') this.loadNutritionData(state.selectedProductId);
                    if (tabName === 'OFFERS') this.loadOffersData(state.selectedProductId);
                    if (tabName === 'ALLERGENS') this.loadAllergenData(state.selectedProductId);
                    if (tabName === 'CLAIMS') this.loadClaimData(state.selectedProductId);
                }
            },

            showCreateProductModal() {
                document.getElementById('modalTitle').textContent = 'ìƒí’ˆ ë“±ë¡';
                document.getElementById('productForm').reset();
                document.getElementById('productId').value = '';
                document.getElementById('productModal').classList.add('active');
            },

            async editProduct(productId) {
                try {
                    const product = await api.getProduct(productId);
                    document.getElementById('modalTitle').textContent = 'ìƒí’ˆ ìˆ˜ì •';
                    document.getElementById('productId').value = product.id;
                    document.getElementById('brandName').value = product.brand_name;
                    document.getElementById('productName').value = product.product_name;
                    document.getElementById('sizeLabel').value = product.size_label || '';
                    document.getElementById('category').value = product.category || 'FOOD';
                    document.getElementById('species').value = product.species || '';
                    document.getElementById('isActive').value = product.is_active ? 'true' : 'false';
                    document.getElementById('adminMemo').value = product.admin_memo || '';
                    document.getElementById('productModal').classList.add('active');
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async saveProduct(event) {
                event.preventDefault();
                const productId = document.getElementById('productId').value;
                const productData = {
                    brand_name: document.getElementById('brandName').value,
                    product_name: document.getElementById('productName').value,
                    size_label: document.getElementById('sizeLabel').value || null,
                    category: document.getElementById('category').value,
                    species: document.getElementById('species').value || null,
                    is_active: document.getElementById('isActive').value === 'true',
                    admin_memo: document.getElementById('adminMemo').value || null
                };

                try {
                    const product = productId 
                        ? await api.updateProduct(productId, productData)
                        : await api.createProduct(productData);
                    
                    utils.showAlert(productId ? 'ìƒí’ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    this.closeProductModal();
                    await this.loadProducts();
                    
                    if (productId && state.selectedProductId === productId) {
                        await this.selectProduct(productId);
                    }
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async toggleArchive(productId, unarchive) {
                const action = unarchive ? 'ë³µêµ¬' : 'ë¹„í™œì„±í™”';
                if (!utils.confirmAction(`ì •ë§ ì´ ìƒí’ˆì„ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

                try {
                    const product = unarchive 
                        ? await api.unarchiveProduct(productId)
                        : await api.archiveProduct(productId);
                    
                    utils.showAlert(`ìƒí’ˆì´ ${action}ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    await this.loadProducts();
                    if (state.selectedProductId === productId) {
                        await this.selectProduct(productId);
                    }
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            closeProductModal() {
                document.getElementById('productModal').classList.remove('active');
            },

            async loadIngredientData(productId) {
                const container = document.getElementById('ingredientContent');
                try {
                    const data = await api.getIngredientProfile(productId);
                    if (!data) {
                        container.innerHTML = '<div class="empty-state"><p style="font-size: 14px; color: var(--muted);">ë“±ë¡ëœ ì„±ë¶„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p><p style="font-size: 13px; color: var(--muted); margin-top: 8px;">ìˆ˜ì • ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë“±ë¡í•˜ì„¸ìš”.</p></div>';
                        return;
                    }
                    
                    // parsed ë°ì´í„° í¬ë§·íŒ…
                    let parsedHtml = '<tr><th>AI ë¶„ì„ ê²°ê³¼</th><td>';
                    if (data.parsed) {
                        try {
                            const parsed = typeof data.parsed === 'string' ? JSON.parse(data.parsed) : data.parsed;
                            parsedHtml += '<div style="background: #f8f9fa; padding: 16px; border-radius: 8px; font-family: monospace; font-size: 13px; max-height: 400px; overflow-y: auto;">';
                            parsedHtml += '<pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">' + JSON.stringify(parsed, null, 2) + '</pre>';
                            parsedHtml += '</div>';
                        } catch (e) {
                            parsedHtml += '<span style="color: var(--muted);">íŒŒì‹± ì˜¤ë¥˜</span>';
                        }
                    } else {
                        parsedHtml += '<span style="color: var(--muted);">AI ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. AI ë¶„ì„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</span>';
                    }
                    parsedHtml += '</td></tr>';
                    
                    container.innerHTML = `
                        <table class="table">
                            <tr><th>ì›ì¬ë£Œ</th><td>${data.ingredients_text || '-'}</td></tr>
                            <tr><th>ì²¨ê°€ë¬¼</th><td>${data.additives_text || '-'}</td></tr>
                            <tr><th>ì¶œì²˜</th><td>${data.source || '-'}</td></tr>
                            <tr><th>ë²„ì „</th><td>v${data.version || 1}</td></tr>
                            <tr><th>ìµœì¢… ìˆ˜ì •ì¼</th><td>${utils.formatDate(data.updated_at)}</td></tr>
                            ${parsedHtml}
                        </table>
                    `;
                } catch (error) {
                    container.innerHTML = `<div class="alert alert-error">${error.message}</div>`;
                }
            },

            async loadNutritionData(productId) {
                const container = document.getElementById('nutritionContent');
                try {
                    const data = await api.getNutritionFacts(productId);
                    if (!data) {
                        container.innerHTML = '<div class="empty-state"><p style="font-size: 14px; color: var(--muted);">ë“±ë¡ëœ ì˜ì–‘ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p><p style="font-size: 13px; color: var(--muted); margin-top: 8px;">ìˆ˜ì • ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë“±ë¡í•˜ì„¸ìš”.</p></div>';
                        return;
                    }
                    container.innerHTML = `
                        <table class="table">
                            <tr><th>ë‹¨ë°±ì§ˆ (%)</th><td>${data.protein_pct !== null ? data.protein_pct : '-'}</td></tr>
                            <tr><th>ì§€ë°© (%)</th><td>${data.fat_pct !== null ? data.fat_pct : '-'}</td></tr>
                            <tr><th>ì„¬ìœ ì§ˆ (%)</th><td>${data.fiber_pct !== null ? data.fiber_pct : '-'}</td></tr>
                            <tr><th>ìˆ˜ë¶„ (%)</th><td>${data.moisture_pct !== null ? data.moisture_pct : '-'}</td></tr>
                            <tr><th>íšŒë¶„ (%)</th><td>${data.ash_pct !== null ? data.ash_pct : '-'}</td></tr>
                            <tr><th>ì¹¼ë¡œë¦¬ (kcal/100g)</th><td>${data.kcal_per_100g !== null ? data.kcal_per_100g : '-'}</td></tr>
                            <tr><th>ì¹¼ìŠ˜ (%)</th><td>${data.calcium_pct !== null ? data.calcium_pct : '-'}</td></tr>
                            <tr><th>ì¸ (%)</th><td>${data.phosphorus_pct !== null ? data.phosphorus_pct : '-'}</td></tr>
                            <tr><th>AAFCO ê¸°ì¤€</th><td>${data.aafco_statement || '-'}</td></tr>
                            <tr><th>ë²„ì „</th><td>v${data.version || 1}</td></tr>
                            <tr><th>ìµœì¢… ìˆ˜ì •ì¼</th><td>${utils.formatDate(data.updated_at)}</td></tr>
                        </table>
                    `;
                } catch (error) {
                    container.innerHTML = `<div class="alert alert-error">${error.message}</div>`;
                }
            },

            async loadOffersData(productId) {
                const container = document.getElementById('offersContent');
                try {
                    const offers = await api.getProductOffers(productId);
                    if (offers.length === 0) {
                        container.innerHTML = '<div class="empty-state"><p style="font-size: 14px; color: var(--muted);">ë“±ë¡ëœ íŒë§¤ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p><p style="font-size: 13px; color: var(--muted); margin-top: 8px;">íŒë§¤ì²˜ ì¶”ê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë“±ë¡í•˜ì„¸ìš”.</p></div>';
                        return;
                    }
                    container.innerHTML = `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>í”Œë«í¼</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>í˜„ì¬ê°€</th>
                                    <th>í†µí™”</th>
                                    <th>Fetch ìƒíƒœ</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${offers.map(offer => `
                                    <tr>
                                        <td>${offer.merchant}</td>
                                        <td>${offer.display_priority}</td>
                                        <td>${offer.current_price ? offer.current_price.toLocaleString() : '-'}</td>
                                        <td>${offer.currency}</td>
                                        <td>
                                            <span class="status-badge" style="background: ${offer.last_fetch_status === 'SUCCESS' ? '#d4edda' : '#f8d7da'};">
                                                ${offer.last_fetch_status || 'NOT_FETCHED'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn-primary" style="padding: 5px 10px; font-size: 12px;" 
                                                    onclick="handlers.editOffer('${offer.id}')">ìˆ˜ì •</button>
                                            <button class="btn-danger" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;" 
                                                    onclick="handlers.deleteOffer('${offer.id}')">ì‚­ì œ</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } catch (error) {
                    container.innerHTML = `<div class="alert alert-error">${error.message}</div>`;
                }
            },

            async loadAllergenData(productId) {
                const container = document.getElementById('allergenContent');
                try {
                    const allergens = await api.getProductAllergens(productId);
                    if (allergens.length === 0) {
                        container.innerHTML = '<div class="empty-state"><p style="font-size: 14px; color: var(--muted);">ë“±ë¡ëœ ì•Œë ˆë¥´ê²ì´ ì—†ìŠµë‹ˆë‹¤.</p><p style="font-size: 13px; color: var(--muted); margin-top: 8px;">ì¶”ê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë“±ë¡í•˜ì„¸ìš”.</p></div>';
                        return;
                    }
                    container.innerHTML = `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ì•Œë ˆë¥´ê²</th>
                                    <th>ì‹ ë¢°ë„ (%)</th>
                                    <th>ì¶œì²˜</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allergens.map(a => `
                                    <tr>
                                        <td>${a.allergen_display_name || a.allergen_code}</td>
                                        <td>${a.confidence}</td>
                                        <td>${a.source || '-'}</td>
                                        <td>
                                            <button class="btn-danger" style="padding: 5px 10px; font-size: 12px;" 
                                                    onclick="handlers.deleteAllergen('${productId}', '${a.allergen_code}')">ì‚­ì œ</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } catch (error) {
                    container.innerHTML = `<div class="alert alert-error">${error.message}</div>`;
                }
            },

            async loadClaimData(productId) {
                const container = document.getElementById('claimContent');
                try {
                    const claims = await api.getProductClaims(productId);
                    if (claims.length === 0) {
                        container.innerHTML = '<div class="empty-state"><p style="font-size: 14px; color: var(--muted);">ë“±ë¡ëœ í´ë ˆì„ì´ ì—†ìŠµë‹ˆë‹¤.</p><p style="font-size: 13px; color: var(--muted); margin-top: 8px;">ì¶”ê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë“±ë¡í•˜ì„¸ìš”.</p></div>';
                        return;
                    }
                    container.innerHTML = `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>í´ë ˆì„</th>
                                    <th>ì¦ê±° ìˆ˜ì¤€ (%)</th>
                                    <th>ë¹„ê³ </th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${claims.map(c => `
                                    <tr>
                                        <td>${c.claim_display_name || c.claim_code}</td>
                                        <td>${c.evidence_level}</td>
                                        <td>${c.note || '-'}</td>
                                        <td>
                                            <button class="btn-danger" style="padding: 5px 10px; font-size: 12px;" 
                                                    onclick="handlers.deleteClaim('${productId}', '${c.claim_code}')">ì‚­ì œ</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } catch (error) {
                    container.innerHTML = `<div class="alert alert-error">${error.message}</div>`;
                }
            },

            async editIngredient(productId) {
                try {
                    const data = await api.getIngredientProfile(productId);
                    this.showIngredientModal(productId, data);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async analyzeAndSaveIngredients(productId) {
                if (!utils.confirmAction('AIë¥¼ ì‚¬ìš©í•˜ì—¬ ì„±ë¶„ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì›ì¬ë£Œ í…ìŠ¤íŠ¸ê°€ ìˆì–´ì•¼ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.')) return;
                
                const container = document.getElementById('ingredientContent');
                const originalContent = container.innerHTML;
                
                try {
                    container.innerHTML = '<div class="loading">AI ë¶„ì„ ì¤‘...</div>';
                    utils.showAlert('AI ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
                    
                    const result = await api.analyzeAndSaveIngredients(productId);
                    
                    utils.showAlert(`AI ë¶„ì„ ì™„ë£Œ! ë²„ì „ v${result.version}ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    
                    // ì„±ë¶„ ì •ë³´ ë‹¤ì‹œ ë¡œë“œ
                    await this.loadIngredientData(productId);
                } catch (error) {
                    container.innerHTML = originalContent;
                    utils.showAlert(error.message, 'error');
                }
            },

            async editNutrition(productId) {
                try {
                    const data = await api.getNutritionFacts(productId);
                    this.showNutritionModal(productId, data);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async editImages(productId) {
                try {
                    const product = await api.getProduct(productId);
                    this.showImagesModal(productId, product);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async addOffer(productId) {
                this.showOfferModal(productId, null);
            },

            async editOffer(offerId) {
                // TODO: offer ìƒì„¸ ì¡°íšŒ í›„ ëª¨ë‹¬ í‘œì‹œ
                utils.showAlert('íŒë§¤ì²˜ ìˆ˜ì • ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë©ë‹ˆë‹¤.', 'info');
            },

            async deleteOffer(offerId) {
                if (!utils.confirmAction('ì •ë§ ì´ íŒë§¤ì²˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                try {
                    await api.deleteOffer(offerId);
                    utils.showAlert('íŒë§¤ì²˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    if (state.selectedProductId) {
                        await this.loadOffersData(state.selectedProductId);
                    }
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async addAllergenInline(productId) {
                if (state.codes.allergenCodes.length === 0) {
                    state.codes.allergenCodes = await api.getAllergenCodes();
                }
                const allergens = await api.getProductAllergens(productId);
                const existingCodes = new Set(allergens.map(a => a.allergen_code));
                const availableCodes = state.codes.allergenCodes.filter(c => !existingCodes.has(c.code));
                
                if (availableCodes.length === 0) {
                    utils.showAlert('ì¶”ê°€í•  ìˆ˜ ìˆëŠ” ì•Œë ˆë¥´ê²ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    return;
                }
                
                const code = prompt(`ì¶”ê°€í•  ì•Œë ˆë¥´ê²ì„ ì„ íƒí•˜ì„¸ìš”:\n${availableCodes.map((c, i) => `${i + 1}. ${c.display_name}`).join('\n')}`);
                if (!code) return;
                
                const selected = availableCodes[parseInt(code) - 1];
                if (!selected) {
                    utils.showAlert('ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.', 'error');
                    return;
                }
                
                try {
                    await api.addProductAllergen(productId, {
                        allergen_code: selected.code,
                        confidence: 80,
                        source: null
                    });
                    utils.showAlert('ì•Œë ˆë¥´ê²ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await this.loadAllergenData(productId);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async deleteAllergen(productId, allergenCode) {
                if (!utils.confirmAction('ì •ë§ ì´ ì•Œë ˆë¥´ê²ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                try {
                    await api.deleteProductAllergen(productId, allergenCode);
                    utils.showAlert('ì•Œë ˆë¥´ê²ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await this.loadAllergenData(productId);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async addClaimInline(productId) {
                if (state.codes.claimCodes.length === 0) {
                    state.codes.claimCodes = await api.getClaimCodes();
                }
                const claims = await api.getProductClaims(productId);
                const existingCodes = new Set(claims.map(c => c.claim_code));
                const availableCodes = state.codes.claimCodes.filter(c => !existingCodes.has(c.code));
                
                if (availableCodes.length === 0) {
                    utils.showAlert('ì¶”ê°€í•  ìˆ˜ ìˆëŠ” í´ë ˆì„ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    return;
                }
                
                const code = prompt(`ì¶”ê°€í•  í´ë ˆì„ì„ ì„ íƒí•˜ì„¸ìš”:\n${availableCodes.map((c, i) => `${i + 1}. ${c.display_name}`).join('\n')}`);
                if (!code) return;
                
                const selected = availableCodes[parseInt(code) - 1];
                if (!selected) {
                    utils.showAlert('ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.', 'error');
                    return;
                }
                
                try {
                    await api.addProductClaim(productId, {
                        claim_code: selected.code,
                        evidence_level: 50,
                        note: null
                    });
                    utils.showAlert('í´ë ˆì„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await this.loadClaimData(productId);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async deleteClaim(productId, claimCode) {
                if (!utils.confirmAction('ì •ë§ ì´ í´ë ˆì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                try {
                    await api.deleteProductClaim(productId, claimCode);
                    utils.showAlert('í´ë ˆì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await this.loadClaimData(productId);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            showIngredientModal(productId, data) {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ì„±ë¶„ ì •ë³´ ${data ? 'ìˆ˜ì •' : 'ë“±ë¡'}</h2>
                            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form onsubmit="handlers.saveIngredient(event, '${productId}')">
                            <div class="form-group">
                                <label>ì›ì¬ë£Œ</label>
                                <textarea id="ingredientText" rows="5">${data?.ingredients_text || ''}</textarea>
                            </div>
                            <div class="form-group">
                                <label>ì²¨ê°€ë¬¼</label>
                                <textarea id="additivesText" rows="5">${data?.additives_text || ''}</textarea>
                            </div>
                            <div class="form-group">
                                <label>ì¶œì²˜</label>
                                <input type="text" id="ingredientSource" value="${data?.source || ''}">
                            </div>
                            ${data ? `<div style="margin-bottom: 10px; color: #666;">í˜„ì¬ ë²„ì „: v${data.version || 1}</div>` : ''}
                            <div style="display: flex; gap: 10px; margin-top: 24px; justify-content: flex-end;">
                                <button type="button" class="btn-secondary" onclick="this.closest('.modal').remove()">ì·¨ì†Œ</button>
                                <button type="submit" class="btn-success">ì €ì¥</button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            showNutritionModal(productId, data) {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ì˜ì–‘ ì •ë³´ ${data ? 'ìˆ˜ì •' : 'ë“±ë¡'}</h2>
                            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form onsubmit="handlers.saveNutrition(event, '${productId}')">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ë‹¨ë°±ì§ˆ (%)</label>
                                    <input type="number" step="0.01" id="proteinPct">
                                </div>
                                <div class="form-group">
                                    <label>ì§€ë°© (%)</label>
                                    <input type="number" step="0.01" id="fatPct">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ì„¬ìœ ì§ˆ (%)</label>
                                    <input type="number" step="0.01" id="fiberPct">
                                </div>
                                <div class="form-group">
                                    <label>ìˆ˜ë¶„ (%)</label>
                                    <input type="number" step="0.01" id="moisturePct">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>íšŒë¶„ (%)</label>
                                    <input type="number" step="0.01" id="ashPct">
                                </div>
                                <div class="form-group">
                                    <label>ì¹¼ë¡œë¦¬ (kcal/100g)</label>
                                    <input type="number" id="kcalPer100g">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ì¹¼ìŠ˜ (%)</label>
                                    <input type="number" step="0.01" id="calciumPct">
                                </div>
                                <div class="form-group">
                                    <label>ì¸ (%)</label>
                                    <input type="number" step="0.01" id="phosphorusPct">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>AAFCO ê¸°ì¤€</label>
                                <textarea id="aafcoStatement" rows="3">${data?.aafco_statement || ''}</textarea>
                            </div>
                            ${data ? `<div style="margin-bottom: 10px; color: #666;">í˜„ì¬ ë²„ì „: v${data.version || 1}</div>` : ''}
                            <div style="display: flex; gap: 10px; margin-top: 24px; justify-content: flex-end;">
                                <button type="button" class="btn-secondary" onclick="this.closest('.modal').remove()">ì·¨ì†Œ</button>
                                <button type="submit" class="btn-success">ì €ì¥</button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // ìˆ«ì í•„ë“œì— ê°’ ì„¤ì • (nullì´ ì•„ë‹ ë•Œë§Œ)
                if (data) {
                    if (data.protein_pct != null) document.getElementById('proteinPct').value = data.protein_pct;
                    if (data.fat_pct != null) document.getElementById('fatPct').value = data.fat_pct;
                    if (data.fiber_pct != null) document.getElementById('fiberPct').value = data.fiber_pct;
                    if (data.moisture_pct != null) document.getElementById('moisturePct').value = data.moisture_pct;
                    if (data.ash_pct != null) document.getElementById('ashPct').value = data.ash_pct;
                    if (data.kcal_per_100g != null) document.getElementById('kcalPer100g').value = data.kcal_per_100g;
                    if (data.calcium_pct != null) document.getElementById('calciumPct').value = data.calcium_pct;
                    if (data.phosphorus_pct != null) document.getElementById('phosphorusPct').value = data.phosphorus_pct;
                }
            },

            showImagesModal(productId, product) {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ì´ë¯¸ì§€ ê´€ë¦¬</h2>
                            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form onsubmit="handlers.saveImages(event, '${productId}')">
                            <div class="form-group">
                                <label>ëŒ€í‘œ ì´ë¯¸ì§€ URL</label>
                                <input type="url" id="primaryImageUrl" value="${product.primary_image_url || ''}">
                                ${product.primary_image_url ? `<img src="${product.primary_image_url}" style="max-width: 200px; margin-top: 10px; border-radius: 10px; border: 1px solid var(--line);" onerror="this.style.display='none'">` : ''}
                            </div>
                            <div class="form-group">
                                <label>ì¸ë„¤ì¼ URL</label>
                                <input type="url" id="thumbnailUrl" value="${product.thumbnail_url || ''}">
                                ${product.thumbnail_url ? `<img src="${product.thumbnail_url}" style="max-width: 200px; margin-top: 10px; border-radius: 10px; border: 1px solid var(--line);" onerror="this.style.display='none'">` : ''}
                            </div>
                            <div class="form-group">
                                <label>ì¶”ê°€ ì´ë¯¸ì§€ (JSON ë°°ì—´)</label>
                                <textarea id="imagesJson" rows="3" placeholder='["url1", "url2"]'>${product.images ? JSON.stringify(product.images, null, 2) : '[]'}</textarea>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 24px; justify-content: flex-end;">
                                <button type="button" class="btn-secondary" onclick="this.closest('.modal').remove()">ì·¨ì†Œ</button>
                                <button type="submit" class="btn-success">ì €ì¥</button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            showOfferModal(productId, offer) {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 800px;">
                        <div class="modal-header">
                            <h2>íŒë§¤ì²˜ ${offer ? 'ìˆ˜ì •' : 'ì¶”ê°€'}</h2>
                            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form onsubmit="handlers.saveOffer(event, '${productId}', '${offer?.id || ''}')">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>í”Œë«í¼ *</label>
                                    <select id="offerMerchant" required>
                                        <option value="COUPANG" ${offer?.merchant === 'COUPANG' ? 'selected' : ''}>ì¿ íŒ¡</option>
                                        <option value="NAVER" ${offer?.merchant === 'NAVER' ? 'selected' : ''}>ë„¤ì´ë²„</option>
                                        <option value="BRAND" ${offer?.merchant === 'BRAND' ? 'selected' : ''}>ë¸Œëœë“œ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ìƒí’ˆ ID *</label>
                                    <input type="text" id="offerMerchantProductId" value="${offer?.merchant_product_id || ''}" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>URL *</label>
                                <input type="url" id="offerUrl" value="${offer?.url || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>ì–´í•„ë¦¬ì—ì´íŠ¸ URL</label>
                                <input type="url" id="offerAffiliateUrl" value="${offer?.affiliate_url || ''}">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ìš°ì„ ìˆœìœ„</label>
                                    <input type="number" id="offerPriority" value="${offer?.display_priority || 10}" min="0">
                                </div>
                                <div class="form-group">
                                    <label>í˜„ì¬ê°€</label>
                                    <input type="number" id="offerCurrentPrice" value="${offer?.current_price || ''}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>í†µí™”</label>
                                    <input type="text" id="offerCurrency" value="${offer?.currency || 'KRW'}" maxlength="3">
                                </div>
                                <div class="form-group">
                                    <label>í™œì„± ìƒíƒœ</label>
                                    <select id="offerIsActive">
                                        <option value="true" ${offer?.is_active !== false ? 'selected' : ''}>í™œì„±</option>
                                        <option value="false" ${offer?.is_active === false ? 'selected' : ''}>ë¹„í™œì„±</option>
                                    </select>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 24px; justify-content: flex-end;">
                                <button type="button" class="btn-secondary" onclick="this.closest('.modal').remove()">ì·¨ì†Œ</button>
                                <button type="submit" class="btn-success">ì €ì¥</button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            async saveIngredient(event, productId) {
                event.preventDefault();
                try {
                    const oldData = await api.getIngredientProfile(productId);
                    const oldVersion = oldData?.version || 0;
                    
                    const data = {
                        ingredients_text: document.getElementById('ingredientText').value || null,
                        additives_text: document.getElementById('additivesText').value || null,
                        source: document.getElementById('ingredientSource').value || null
                    };
                    
                    const result = await api.updateIngredientProfile(productId, data);
                    utils.showAlert(`ì €ì¥ ì™„ë£Œ Â· v${oldVersion} â†’ v${result.version}`, 'success');
                    event.target.closest('.modal').remove();
                    await this.loadIngredientData(productId);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async saveNutrition(event, productId) {
                event.preventDefault();
                try {
                    const oldData = await api.getNutritionFacts(productId);
                    const oldVersion = oldData?.version || 0;
                    
                    const getValue = (id) => {
                        const val = document.getElementById(id).value;
                        return val === '' ? null : (id.includes('Pct') ? parseFloat(val) : parseInt(val));
                    };
                    
                    const data = {
                        protein_pct: getValue('proteinPct'),
                        fat_pct: getValue('fatPct'),
                        fiber_pct: getValue('fiberPct'),
                        moisture_pct: getValue('moisturePct'),
                        ash_pct: getValue('ashPct'),
                        kcal_per_100g: getValue('kcalPer100g'),
                        calcium_pct: getValue('calciumPct'),
                        phosphorus_pct: getValue('phosphorusPct'),
                        aafco_statement: document.getElementById('aafcoStatement').value || null
                    };
                    
                    const result = await api.updateNutritionFacts(productId, data);
                    utils.showAlert(`ì €ì¥ ì™„ë£Œ Â· v${oldVersion} â†’ v${result.version}`, 'success');
                    event.target.closest('.modal').remove();
                    await this.loadNutritionData(productId);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async saveImages(event, productId) {
                event.preventDefault();
                try {
                    let images = [];
                    try {
                        images = JSON.parse(document.getElementById('imagesJson').value);
                    } catch (e) {
                        throw new Error('ì¶”ê°€ ì´ë¯¸ì§€ JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                    
                    const data = {
                        primary_image_url: document.getElementById('primaryImageUrl').value || null,
                        thumbnail_url: document.getElementById('thumbnailUrl').value || null,
                        images: images
                    };
                    
                    await api.updateProductImages(productId, data);
                    utils.showAlert('ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    event.target.closest('.modal').remove();
                    if (state.selectedProductId === productId) {
                        const product = await api.getProduct(productId);
                        render.productDetail(product);
                    }
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            },

            async saveOffer(event, productId, offerId) {
                event.preventDefault();
                try {
                    const data = {
                        merchant: document.getElementById('offerMerchant').value,
                        merchant_product_id: document.getElementById('offerMerchantProductId').value,
                        url: document.getElementById('offerUrl').value,
                        affiliate_url: document.getElementById('offerAffiliateUrl').value || null,
                        display_priority: parseInt(document.getElementById('offerPriority').value) || 10,
                        current_price: document.getElementById('offerCurrentPrice').value ? parseInt(document.getElementById('offerCurrentPrice').value) : null,
                        currency: document.getElementById('offerCurrency').value || 'KRW',
                        is_active: document.getElementById('offerIsActive').value === 'true'
                    };
                    
                    if (offerId) {
                        await api.updateOffer(offerId, data);
                        utils.showAlert('íŒë§¤ì²˜ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    } else {
                        await api.createOffer(productId, data);
                        utils.showAlert('íŒë§¤ì²˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    }
                    
                    event.target.closest('.modal').remove();
                    await this.loadOffersData(productId);
                } catch (error) {
                    utils.showAlert(error.message, 'error');
                }
            }
        };

        // ê¸°ì¡´ í•¨ìˆ˜ë“¤ì„ handlersë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (í•˜ìœ„ í˜¸í™˜ì„±)
        function loadProducts() { return handlers.loadProducts(); }
        function selectProduct(id) { return handlers.selectProduct(id); }
        function showCreateProductModal() { return handlers.showCreateProductModal(); }
        function closeProductModal() { return handlers.closeProductModal(); }
        function showAlert(msg, type) { return utils.showAlert(msg, type); }
        function switchTab(tab) { return handlers.switchTab(tab); }
        function editProduct(id) { return handlers.editProduct(id); }
        function saveProduct(e) { return handlers.saveProduct(e); }
        function deleteProduct(id) { return handlers.deleteProduct(id); }
        function editIngredient(id) { return handlers.editIngredient(id); }
        function editNutrition(id) { return handlers.editNutrition(id); }
        function editAllergen(id) { return handlers.editAllergen(id); }
        function editClaim(id) { return handlers.editClaim(id); }
        function deleteAllergen(pid, code) { return handlers.deleteAllergen(pid, code); }
        function deleteClaim(pid, code) { return handlers.deleteClaim(pid, code); }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” (handlers ì •ì˜ í›„)
        window.onload = async () => {
            await handlers.init();
        };
    </script>
</body>
</html>
